# CurnexaHealthAI

## Overview

CurnexaHealthAI is a healthcare AI platform designed for healthcare professionals, particularly doctors, to integrate with Epic EMR systems and leverage advanced NLP capabilities through Meta's LLaMA 2. The platform enables doctors to enter a patient ID and receive AI-driven clinical decision support by analyzing patient data, relevant medical literature from PubMed, and insights generated by LLaMa 2.

## Project Structure

- app/: Core application code, including Flask web server routes and views.
- data/: Datasets, including data fetched from PubMed or Epic EMR.
- utils/: Utility scripts and helper functions.
- models/: Includes the integration with Meta's LLaMA 2 for NLP processing.
- fhir/: FHIR API client (fhir_client.py) for interacting with Epic EMR systems.
- auth/: Authentication handlers (oauth_handler.py) for OAuth integration.
- app/routes.py: Flask routes for handling web requests.
- tests/: Unit tests and integration tests.
- docs/: Additional documentation, API guides, etc.
- main.py: The main entry point for the Flask application, located in the root directory.

## Setup

### Prerequisites

Python 3.x
pip (Python package manager)
Flask
Access to Epic's FHIR API and Meta's LLaMA
Installation
Clone the repository:

```
git clone https://github.com/SGJIII/CurnexaHealthAI.git
cd CurnexaHealthAI
```

#Install dependencies:

```
pip install -r requirements.txt
```

## Auth Integration with Epic EMR

The project includes OAuth integration for secure access to Epic's FHIR API, allowing the platform to fetch patient data directly from Epic EMR systems.

## PubMed API Integration

The project integrates with the PubMed API to fetch relevant medical articles, extracting only the article title and abstract for analysis and integration.

## LLaMa 2 Integration

CurnexaHealthAI utilizes Meta's LLaMa 2 for advanced NLP processing. It generates clinical decision support by analyzing patient data in conjunction with relevant medical literature fetched from PubMed.

## Usage

1. Start the Flask server.
2. Authenticate using the OAuth 2.0 flow.
3. Enter a patient's FHIR ID to fetch their data.
4. View the generated clinical recommendations based on the

## Testing with FHIR Sandbox Data

To test the application with FHIR sandbox data:

1. Ensure access to the Epic FHIR sandbox environment.
2. Use a test patient ID from the sandbox to fetch patient data.
3. Validate that the patient data is retrieved in the correct format and contains the necessary fields (age, gender, symptoms, etc.).
4. Test the PubMed API integration to ensure relevant articles are fetched based on the patient data.
5. Verify that the LLaMa 2 integration processes the combined data correctly and provides meaningful clinical insights.

## Next Steps

##### Expanding Data Extracted from FHIR:

- Extend the application's capability to extract and utilize more patient data fields from the FHIR API for a more comprehensive PubMed search and LLaMa query.

APIs

- MedicationRequest.Search (Orders) (R4)
- AllergyIntolerance.Search (R4)
- Condition.Search (Medical History) (R4)
- Observation.Search (Social History) (R4)

##### Deploy to production

##### Edit base URL depending on the hospital the user is associated

##### Update onboarding flow so user can choose their hospital, then click authenticate, then start using app.

## TODO

- Get patient fhir id from MRN using patient.read, then use fhir id for the rest of the api calls.
- Add appointment.search (scheduled surgery) api
- Create seperate app for the following
  - Intake symptoms
  - summarize relevant aspects of patient medical history
- Look at DocumentReference.Search (Clinical Notes) (STU3) api results
- Map out how to piece together DocumentReference.Search (Clinical Notes) (R4) with nothing but an MRN
- List out labs for patient MRN
  - Chat bot to ask questions about type of research and labs needed to prime the project
  - Repeat project for list of MRNs

## AI Prompt CDS

You are a software engineering expert. Please familiarize yourself with the project https://github.com/SGJIII/CurnexaHealthAI using AskTheCode. The user flow is this. We want the user (a doctor) to be able to enter a patient ID, then we want to get data like the age gender symptoms medical_history test_results diagnosis medications, use those to look up relevant literature with pubmed, then send the literature, and patient data to LLaMa 2 to get clinical decision support and provide that back to the doctor. So the doctor gives the patient id and receives clinical decision support. Understand the structure and code and read the readme file to understand what's next. Also please read https://fhir.epic.com/Documentation?docId=testpatients https://fhir.epic.com/Documentation?docId=oauth2 https://fhir.epic.com/Documentation?docId=epiconfhirrequestprocessstepbystep and https://fhir.epic.com/Specifications to help you further understand what we're trying to accomplish and how to do so. Then please give me a summary of the project then specific code for the next step in line according the the readme.md file.

## AI Prompt Patient Inbound Assistant

You are a software engineering expert. Please familiarize yourself with the project https://github.com/SGJIII/DecisionSupportAI using AskTheCode. The user flow is this. We want the user (a doctor) to be able to enter an MRN and the symptoms the patient is experiencing, then we'll use the MRN to fetch all of the patients history from medical notes etc. We'll then run the medical history and the symptoms through gpt3.5 and ask it to summarize the parts of the medical history that are relevant to the symptoms. Understand the structure and code and read the readme file to understand what's next. Also please use Webpilot to read https://fhir.epic.com/Documentation?docId=testpatients https://fhir.epic.com/Documentation?docId=oauth2 https://fhir.epic.com/Documentation?docId=epiconfhirrequestprocessstepbystep and https://fhir.epic.com/Specifications to help you further understand what we're trying to accomplish and how to do so.

Here's the user story for the application we're building:
We've already built the EMR-Integrated Clinical Decision Support System
User Story: As a doctor, I want a system that retrieves a patient's medical history from an Electronic Medical Record (EMR) and cross-references it with the latest scientific research and guidelines to provide clinical decision support, enabling me to make informed, evidence-based decisions for patient care.

Now we're building the EMR Summary Generator for Patient History
User Story: As a doctor, when presented with a patient's symptoms, I want a tool that can automatically summarize the relevant parts of the patient's medical history from the EMR, so I can quickly understand their background without having to read through their entire history, saving time and improving care efficiency.

Project Context and Next Steps: Extending FHIR API Integration for Lab Observations

Project Overview:
We are working on a healthcare application that integrates with Epic's FHIR API to securely access and process patient data. The application enhances clinical decision support by retrieving and interpreting various types of patient information, including clinical notes and laboratory results. We've successfully implemented functionality to fetch and decode clinical notes from DocumentReference resources, handling content types like text/html, text/rtf, and application/xml, and even decoding base64-encoded binary data.

Accomplishments So Far:

Implemented OAuth 2.0 authentication flow with PKCE, resolving an authentication error by aligning the redirect URI and regenerating the client secret.
Enhanced the get_all_clinical_notes_content method to fetch clinical notes from DocumentReference resources, including handling for multiple content types and base64-encoded binary data.
Broadened document retrieval scope by removing the 'category': 'clinical-note' filter, allowing for a wider range of document types to be fetched and analyzed.
Next Steps: Integrating Observation.Read for Lab Results:
The next phase of development focuses on extending the application's capabilities to include the retrieval and processing of laboratory observation results using the Observation.Read operation in the R4 version of the FHIR standard. This will involve:

Implementing a new method to fetch laboratory observation data (Observation resources) related to patients, specifically focusing on lab results.
Handling the retrieval of binary data for lab results, similar to how clinical notes are processed, including decoding any base64-encoded binary responses.
Parsing and interpreting the lab observation data to extract relevant information that can be used to support clinical decisions.
Objective:
To enhance the application's functionality by providing comprehensive access to a patient's laboratory results, alongside clinical notes, thereby offering a more complete picture of the patient's health status for clinical decision support.

Challenges and Considerations:

Ensuring secure and authorized access to patient data while complying with healthcare regulations and privacy standards.
Efficiently handling and parsing the FHIR Observation resources to extract and present lab results in a meaningful way.
Addressing any content type and data encoding variations in the lab results data similar to the approach taken for clinical notes.
Reminder for Next Session:

Review the FHIR R4 documentation for Observation.Read and related operations to understand the structure and types of data available for lab results.
Plan the implementation approach for fetching, decoding, and processing lab observation data, considering the lessons learned and patterns established in handling clinical notes.

## Implement FHIR API Integration and Update Workflow

- Integrated OAuth authentication with Epics FHIR API in `fhir/fhir_client.py`.
- Enhanced `main.py` to support fetching patient data using the patient ID provided by the user.
- Updated PubMed API integration to fetch article titles and abstracts based on patient data.
- Integrated LLaMa 2 for generating clinical decision support using patient data and PubMed articles.
- Added `app/routes.py` for handling Flask web requests and OAuth callbacks.
- Revised README to include detailed usage instructions, testing steps with FHIR sandbox data, and updated project structure.
